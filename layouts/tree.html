<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TreeLayout 示例 | GoJS 布局画廊</title>
    <script src="https://unpkg.com/gojs/release/go.js"></script>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(160deg, #ecfeff 0%, #fef3c7 100%);
        color: #0f172a;
      }

      header {
        padding: 32px 16px 20px;
        text-align: center;
      }

      header h1 {
        margin: 0;
        font-size: clamp(26px, 4vw, 36px);
        color: #1f2937;
      }

      header p {
        margin: 12px auto 0;
        max-width: 600px;
        line-height: 1.6;
        color: #4b5563;
      }

      main {
        max-width: 1080px;
        margin: 0 auto;
        padding: 16px 16px 56px;
      }

      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 12px;
      }

      .back-link {
        color: #d97706;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .back-link::before {
        content: "←";
        font-size: 18px;
      }

      #diagramDiv {
        width: 100%;
        height: 640px;
        border-radius: 16px;
        border: 1px solid rgba(234, 179, 8, 0.4);
        background: rgba(255, 255, 255, 0.85);
        box-shadow: 0 24px 60px rgba(217, 119, 6, 0.18);
      }

      .legend {
        margin-top: 18px;
        display: grid;
        gap: 10px;
        padding: 16px 18px;
        border-radius: 12px;
        background: rgba(253, 230, 138, 0.4);
        border: 1px solid rgba(217, 119, 6, 0.32);
        font-size: 14px;
      }

      .legend strong {
        color: #b45309;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>TreeLayout 示例</h1>
      <p>
        自上而下展开的多层树形结构，包含 50 个节点，能够清晰展示配电网络或组织架构的层级关系。
      </p>
    </header>
    <main>
      <div class="toolbar">
        <a class="back-link" href="../index.html">返回布局画廊</a>
        <span>节点数：50 · 连接数：49</span>
      </div>
      <div id="diagramDiv" role="presentation" aria-label="TreeLayout 示例"></div>
      <div class="legend">
        <div><strong>节点配色</strong>：根据层级深度渐变，帮助区分不同层级。</div>
        <div><strong>布局参数</strong>：使用 angle=90 的 TreeLayout，自上而下展开，每层保持均匀间距。</div>
      </div>
    </main>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const $ = go.GraphObject.make;

        const colors = ["#fde68a", "#fbbf24", "#f59e0b", "#d97706", "#b45309"];
        const nodeCount = 50;
        const nodes = [{ key: 0, text: "中心节点", level: 0, fill: colors[0] }];

        for (let i = 1; i < nodeCount; i++) {
          const parentIndex = Math.floor((i - 1) / 3);
          const parent = nodes[parentIndex];
          const level = Math.min(parent.level + 1, colors.length - 1);
          nodes.push({
            key: i,
            parent: parent.key,
            text: `节点 ${i + 1}`,
            level,
            fill: colors[level]
          });
        }

        const diagram = $(go.Diagram, "diagramDiv", {
          layout: $(go.TreeLayout, {
            angle: 90,
            nodeSpacing: 24,
            layerSpacing: 80
          }),
          "undoManager.isEnabled": false
        });

        diagram.nodeTemplate = $(
          go.Node,
          "Auto",
          $(
            go.Shape,
            "RoundedRectangle",
            {
              fill: "#fde68a",
              stroke: "rgba(180, 83, 9, 0.2)",
              strokeWidth: 1,
              desiredSize: new go.Size(110, 44)
            },
            new go.Binding("fill", "fill")
          ),
          $(
            go.TextBlock,
            {
              margin: 6,
              font: "bold 13px 'Segoe UI'",
              stroke: "#78350f"
            },
            new go.Binding("text", "text")
          )
        );

        diagram.linkTemplate = $(
          go.Link,
          {
            routing: go.Link.Orthogonal,
            corner: 6,
            selectable: false
          },
          $(go.Shape, { strokeWidth: 1.5, stroke: "rgba(180, 83, 9, 0.6)" })
        );

        diagram.model = new go.TreeModel({ nodeDataArray: nodes });
      });
    </script>
  </body>
</html>
